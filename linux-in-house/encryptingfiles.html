<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>EncryptingFiles</title>
        <link rel="icon" type="image/svg" href="https://dfcsoftware.github.io/linux-in-house/images/favicon.svg">
        <link rel="stylesheet" href="https://dfcsoftware.github.io/linux-in-house/theme/css/main.css" type="text/css" />
        <!-- <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />  -->
        <link href="https://dfcsoftware.github.io/linux-in-house/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Linux Home Administration Atom Feed" />
        <meta name="description" content="Encrypting Files You should protect your carefully built system and it's files from abuse, tampering, or just plain spying. It's easy to do, what..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <table>
                    <td><h1><a href="https://dfcsoftware.github.io/linux-in-house/">Linux Home Administration</a></h1></td>
                    <td> <link href="/linux-in-house/pagefind/pagefind-ui.css" rel="stylesheet" type="text/css">
<script src="/linux-in-house/pagefind/pagefind-ui.js"></script>
<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script> </td>
                </table>
                <nav><ul>
                    <li class="active"><a href="https://dfcsoftware.github.io/linux-in-house/category/linux.html">linux</a></li>
                    <li><a href="https://dfcsoftware.github.io/linux-in-house/category/writing.html">writing</a></li>
                    <li><a href="https://dfcsoftware.github.io/linux-in-house/category/zines.html">zines</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://dfcsoftware.github.io/linux-in-house/encryptingfiles.html" rel="bookmark"
           title="Permalink to EncryptingFiles">EncryptingFiles</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-03-07T00:00:00-05:00">
                Published: Tue 07 March 2023
        </abbr>
		<br />
        <abbr class="modified" title="2024-04-19T09:30:00-04:00">
                Updated: Fri 19 April 2024
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://dfcsoftware.github.io/linux-in-house/author/don-cohoon.html">Don Cohoon</a>
        </address>
<p>In <a href="https://dfcsoftware.github.io/linux-in-house/category/linux.html">linux</a>.</p>
<p>tags: <a href="https://dfcsoftware.github.io/linux-in-house/tag/security.html">security</a> </p>
</footer><!-- /.post-info -->      <h1 id="encrypting-files">Encrypting Files</h1>
<p>You should protect your carefully built system and it's files from abuse, tampering, or just plain spying. It's easy to do, what are you waiting for? Encrypt your data directory <strong>now</strong>.</p>
<hr>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#encrypting-files">Encrypting Files</a><ul>
<li><a href="#encrypt-disk-partition-using-luks-format">Encrypt disk partition using LUKS Format</a></li>
<li><a href="#encrypt-a-file">Encrypt a file</a></li>
<li><a href="#gpg-key-files">GPG key files</a><ul>
<li><a href="#create-a-gpg-keypair">Create a GPG keypair</a></li>
<li><a href="#edit-your-gpg-key">Edit your GPG key</a></li>
<li><a href="#list-gpg-keys">List GPG keys</a></li>
<li><a href="#export-public-gpg-key">Export Public GPG key</a><ul>
<li><a href="#sharing-public-keys">Sharing public keys</a></li>
<li><a href="#fingerprints">Fingerprints</a></li>
</ul>
</li>
<li><a href="#protonmail">Protonmail</a></li>
<li><a href="#copy-keys-to-e-mail-client-host">Copy keys to e-mail client host</a></li>
<li><a href="#revoke-certificate">Revoke Certificate</a></li>
<li><a href="#encryptdecrypt-a-file-with-a-key">Encrypt/decrypt a file with a key</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<hr>
<p>Also E-Mailing files is <strong>not</strong> secure, but you can encrypt that file before sending it and the other party can decrypt it with just a simple pass phrase.</p>
<h2 id="encrypt-disk-partition-using-luks-format">Encrypt disk partition using LUKS Format</h2>
<p>1 - Create cryptographic device mapper device in LUKS encryption mode:</p>
<div class="highlight"><pre><span></span><code><span class="nv">sudo</span><span class="w"> </span><span class="nv">cryptsetup</span><span class="w"> </span><span class="o">--</span><span class="nv">verbose</span><span class="w"> </span><span class="o">--</span><span class="nv">cipher</span><span class="w"> </span><span class="nv">aes</span><span class="o">-</span><span class="nv">xts</span><span class="o">-</span><span class="nv">plain64</span><span class="w"> </span><span class="o">--</span><span class="nv">key</span><span class="o">-</span><span class="nv">size</span><span class="w"> </span><span class="mi">512</span><span class="w"> </span><span class="o">--</span><span class="nv">hash</span><span class="w"> </span><span class="nv">sha512</span><span class="w"> </span><span class="o">--</span><span class="nv">iter</span><span class="o">-</span><span class="nv">time</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">--</span><span class="nv">use</span><span class="o">-</span><span class="k">random</span><span class="w"> </span><span class="nv">luksFormat</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">sdd1</span>
</code></pre></div>

<p>2 - Unlock the partition, here "backup" is device mapper name, think of it as label. </p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">cryptsetup</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="o">--</span><span class="k">type</span><span class="w"> </span><span class="nx">luks</span><span class="w"> </span><span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">sdd1</span><span class="w"> </span><span class="nx">backup</span>
</code></pre></div>

<p>3 - We have to create filesystem in order to write encrypted data that would be accessible through the device mapper name (label).</p>
<div class="highlight"><pre><span></span><code>sudo mkfs.ext4 /dev/mapper/backup
</code></pre></div>

<p>4 - Mount the device and transfer all of your data:</p>
<div class="highlight"><pre><span></span><code>sudo mount -t ext4 /dev/mapper/backup /backups
</code></pre></div>

<p>5 - Unmount and close the device once you are done:</p>
<div class="highlight"><pre><span></span><code>sudo umount /backup
<span class="gh">#</span>
sudo cryptsetup close backup
<span class="gh">#</span>
#Last but not least, clear the copy and cache buffers:
<span class="gh">#</span>
sudo sysctl --write vm.drop_caches=3
</code></pre></div>

<p>Reference: </p>
<ul>
<li><a href="https://www.man7.org/linux/man-pages/man8/cryptsetup.8.html">https://www.man7.org/linux/man-pages/man8/cryptsetup.8.html</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/sysctl/vm.html?highlight=drop_caches#drop-caches">https://www.kernel.org/doc/html/latest/admin-guide/sysctl/vm.html?highlight=drop_caches#drop-caches</a></li>
</ul>
<h2 id="encrypt-a-file">Encrypt a file</h2>
<p>Create a file to encrypt:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Cold!&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>mittens
</code></pre></div>

<p>Encrypt it:</p>
<blockquote>
<p>You will be prompted for a pass phrase</p>
</blockquote>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>-c<span class="w"> </span>mittens
</code></pre></div>

<p>Check the output:</p>
<blockquote>
<p><file name >.gpg is the encrypted version, the original file is left intact</p>
</blockquote>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>mittens*
mittens
mittens.gpg

$<span class="w"> </span>strings<span class="w"> </span>mittens*
Cold!
O2#a3
</code></pre></div>

<p>You can now distribute the encrypted file. <strong>You must also <em>securely</em> share the passphrase.</strong></p>
<p>Decrypt it </p>
<blockquote>
<p>This example uses the public keyring stored on this computer user's home directory <code>~/.gnupg</code></p>
</blockquote>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>-d<span class="w"> </span>mittens.gpg<span class="w"> </span>
gpg:<span class="w"> </span>AES256.CFB<span class="w"> </span>encrypted<span class="w"> </span>data
gpg:<span class="w"> </span>encrypted<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>passphrase
Cold!
</code></pre></div>

<p>Files created the first time you run gpg:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>~/.gnupg/
private-keys-v1.d<span class="w">  </span>pubring.kbx<span class="w">  </span>random_seed
</code></pre></div>

<p>Reference: <a href="https://www.redhat.com/sysadmin/getting-started-gpg">https://www.redhat.com/sysadmin/getting-started-gpg</a></p>
<h2 id="gpg-key-files">GPG key files</h2>
<p>GPG supports private and public key files so passphrases are not required in normal use for encrypting, decrypting and signing files and e-mails.</p>
<p>Here is how that works.</p>
<h3 id="create-a-gpg-keypair">Create a GPG keypair</h3>
<blockquote>
<p>Use the default (1)</p>
</blockquote>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--full-generate-key
Please<span class="w"> </span><span class="k">select</span><span class="w"> </span>what<span class="w"> </span>kind<span class="w"> </span>of<span class="w"> </span>key<span class="w"> </span>you<span class="w"> </span>want:
<span class="w">   </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span>and<span class="w"> </span>RSA<span class="w"> </span><span class="o">(</span>default<span class="o">)</span>
...
</code></pre></div>

<blockquote>
<p>Use the default 3072</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nv">RSA</span><span class="w"> </span><span class="nv">keys</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">between</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="nv">bits</span><span class="w"> </span><span class="nv">long</span>.
<span class="nv">What</span><span class="w"> </span><span class="nv">keysize</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span>?<span class="w"> </span><span class="ss">(</span><span class="mi">3072</span><span class="ss">)</span>
</code></pre></div>

<blockquote>
<p>Enter 2 years</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nv">Please</span><span class="w"> </span><span class="nv">specify</span><span class="w"> </span><span class="nv">how</span><span class="w"> </span><span class="nv">long</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">valid</span>.
<span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">does</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">expire</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nv">n</span><span class="o">&gt;</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">expires</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">days</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nv">n</span><span class="o">&gt;</span><span class="nv">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">expires</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">weeks</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nv">n</span><span class="o">&gt;</span><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">expires</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">months</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nv">n</span><span class="o">&gt;</span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="nv">expires</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">years</span>
<span class="nv">Key</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">valid</span><span class="w"> </span><span class="k">for</span>?<span class="w"> </span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="mi">2</span><span class="nv">y</span>
</code></pre></div>

<ul>
<li>Fill out your name, email, etc.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">GnuPG</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">construct</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">identify</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">key</span><span class="o">.</span>

<span class="n">Real</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Best</span><span class="w"> </span><span class="n">User</span>
<span class="n">Email</span><span class="w"> </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="n">bestuser</span><span class="err">@</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Comment</span><span class="p">:</span><span class="w"> </span><span class="n">Best</span><span class="w"> </span><span class="n">Company</span>
<span class="n">You</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">USER</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span>
<span class="w">    </span><span class="s2">&quot;Best User (Best Company) &lt;bestuser@example.com&gt;&quot;</span>

<span class="n">Change</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="n">ame</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="n">omment</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="n">mail</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="n">O</span><span class="p">)</span><span class="n">kay</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="n">uit</span><span class="err">?</span>
</code></pre></div>

<blockquote>
<p>Enter a passphrase in the popup</p>
</blockquote>
<ul>
<li>Verify your information, then a keystore will be created in your home directory:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="n">We</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="n">idea</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">perform</span>
<span class="ow">some</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="k">action</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">keyboard</span><span class="p">,</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mouse</span><span class="p">,</span><span class="w"> </span><span class="n">utilize</span><span class="w"> </span><span class="n">the</span>
<span class="n">disks</span><span class="p">)</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prime</span><span class="w"> </span><span class="n">generation</span><span class="p">;</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">gives</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">number</span>
<span class="n">generator</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">chance</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">gain</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">entropy</span><span class="p">.</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">B</span><span class="p">..</span><span class="mf">.5</span><span class="w"> </span><span class="n">marked</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ultimately</span><span class="w"> </span><span class="n">trusted</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="s1">&#39;/home/bob/.gnupg/openpgp-revocs.d&#39;</span><span class="w"> </span><span class="n">created</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">revocation</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;/home/bob/.gnupg/openpgp-revocs.d/A...3.rev&#39;</span>
<span class="k">public</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">secret</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">signed</span><span class="p">.</span>

<span class="n">pub</span><span class="w">   </span><span class="n">rsa3072</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">[</span><span class="n">SC</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">expires: 2025-04-19</span><span class="o">]</span>
<span class="w">      </span><span class="n">A</span><span class="p">..</span><span class="mf">.3</span>
<span class="n">uid</span><span class="w">                      </span><span class="n">Bob</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bob</span><span class="nv">@bob</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">sub</span><span class="w">   </span><span class="n">rsa3072</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">[</span><span class="n">E</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">expires: 2025-04-19</span><span class="o">]</span>
</code></pre></div>

<ul>
<li>Store your host, username, and passphrase in your password manager.</li>
</ul>
<p>Files created:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>~/.gnupg/
/home/bob/.gnupg/
├──<span class="w"> </span>openpgp-revocs.d
│<span class="w">   </span>└──<span class="w"> </span>B...5.rev
├──<span class="w"> </span>private-keys-v1.d
│<span class="w">   </span>├──<span class="w"> </span>C...2.key
│<span class="w">   </span>└──<span class="w"> </span>A...3.key
├──<span class="w"> </span>pubring.kbx
├──<span class="w"> </span>pubring.kbx~
├──<span class="w"> </span>random_seed
└──<span class="w"> </span>trustdb.gpg
</code></pre></div>

<h3 id="edit-your-gpg-key">Edit your GPG key</h3>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--edit-key<span class="w"> </span>bestuser@example.com
gpg&gt;
</code></pre></div>

<p>At the subprompt, help or a ? lists the available edit commands.</p>
<h3 id="list-gpg-keys">List GPG keys</h3>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="n">list</span><span class="o">-</span><span class="n">keys</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">checking</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trustdb</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">marginals</span><span class="w"> </span><span class="nl">needed</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">  </span><span class="n">completes</span><span class="w"> </span><span class="nl">needed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="n">trust</span><span class="w"> </span><span class="nl">model</span><span class="p">:</span><span class="w"> </span><span class="n">pgp</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="k">depth</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="nl">valid</span><span class="p">:</span><span class="w">   </span><span class="mi">1</span><span class="w">  </span><span class="nl">signed</span><span class="p">:</span><span class="w">   </span><span class="mi">0</span><span class="w">  </span><span class="nl">trust</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="o">-</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">u</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">trustdb</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">19</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">bob</span><span class="o">/</span><span class="p">.</span><span class="n">gnupg</span><span class="o">/</span><span class="n">pubring</span><span class="p">.</span><span class="n">kbx</span>
<span class="o">----------------------------</span>
<span class="n">pub</span><span class="w">   </span><span class="n">rsa3072</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">[</span><span class="n">SC</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">expires: 2025-04-19</span><span class="o">]</span>
<span class="w">      </span><span class="n">A</span><span class="p">..</span><span class="mf">.3</span>
<span class="n">uid</span><span class="w">           </span><span class="o">[</span><span class="n">ultimate</span><span class="o">]</span><span class="w"> </span><span class="n">Bob</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bob</span><span class="nv">@bob</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">sub</span><span class="w">   </span><span class="n">rsa3072</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">[</span><span class="n">E</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">expires: 2025-04-19</span><span class="o">]</span>
</code></pre></div>

<h3 id="export-public-gpg-key">Export Public GPG key</h3>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--export<span class="w"> </span>--armor<span class="w"> </span>--output<span class="w"> </span>bob-gpg.pub
$<span class="w"> </span>more<span class="w"> </span>bob-gpg.pub<span class="w"> </span>
-----BEGIN<span class="w"> </span>PGP<span class="w"> </span>PUBLIC<span class="w"> </span>KEY<span class="w"> </span>BLOCK-----
...
</code></pre></div>

<p>The -a or --armor option encodes the output to plain text. 
The -o or --output option saves the output to a specified file instead of displaying it to standard out on the screen.</p>
<h4 id="sharing-public-keys">Sharing public keys</h4>
<blockquote>
<p>You can share your <strong>public key</strong> to the OpenPGP Key server [1]. This way <em>other people</em> can read your e-mails, they just need to import your key from the keyserver using your email address.</p>
</blockquote>
<ul>
<li>Pros: </li>
<li>Public key servers allow other people to easily read your encrypted e-mails.</li>
<li>Signing verifies the email came from you.</li>
<li>
<p>It also guarantees the message was not altered.</p>
</li>
<li>
<p>Cons:</p>
</li>
<li>It does <em>not</em> assure privacy, because if a third party gets ahold of your encrypted email they can still decrypt it using your public key on a public server.</li>
<li>
<p>After your certificate expires or is revoked, encrypted messages become unreadable. Renewed certificates allow old messages to be read.</p>
</li>
<li>
<p><a href="https://keys.openpgp.org/upload">https://keys.openpgp.org/upload</a></p>
</li>
</ul>
<h4 id="fingerprints">Fingerprints</h4>
<p>To allow other people a method of verifying the public key, also share the fingerprint of the public key in email signatures and even on business cards. The more places it appears, the more likely others will have a copy of the correct fingerprint to use for verification.</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="n">fingerprint</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">bob</span><span class="o">/</span><span class="p">.</span><span class="n">gnupg</span><span class="o">/</span><span class="n">pubring</span><span class="p">.</span><span class="n">kbx</span>
<span class="o">----------------------------</span>
<span class="n">pub</span><span class="w">   </span><span class="n">rsa3072</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">[</span><span class="n">SC</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">expires: 2025-04-19</span><span class="o">]</span>
<span class="w">      </span><span class="n">A</span><span class="p">...</span><span class="w"> </span><span class="mf">3.</span><span class="p">..</span><span class="w"> </span><span class="mf">5.</span><span class="p">..</span><span class="w"> </span><span class="mf">7.</span><span class="p">..</span><span class="w"> </span><span class="n">D</span><span class="p">...</span><span class="w">  </span><span class="mf">9.</span><span class="p">..</span><span class="w"> </span><span class="n">A</span><span class="p">...</span><span class="w"> </span><span class="n">E</span><span class="p">...</span><span class="w"> </span><span class="mf">1.</span><span class="p">..</span><span class="w"> </span><span class="mf">4.</span><span class="p">..</span>
<span class="n">uid</span><span class="w">           </span><span class="o">[</span><span class="n">ultimate</span><span class="o">]</span><span class="w"> </span><span class="n">Bob</span><span class="w"> </span><span class="o">&lt;</span><span class="n">bob</span><span class="nv">@bob</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">sub</span><span class="w">   </span><span class="n">rsa3072</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">[</span><span class="n">E</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">expires: 2025-04-19</span><span class="o">]</span>
</code></pre></div>

<p>Reference: <a href="https://www.redhat.com/sysadmin/creating-gpg-keypairs">https://www.redhat.com/sysadmin/creating-gpg-keypairs</a></p>
<h3 id="protonmail">Protonmail</h3>
<p>To obtain a correspondent's protonmail public key, use curl. Change user@protonmail.com to the real email.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>curl<span class="w"> </span>https://api.protonmail.ch/pks/lookup?op<span class="o">=</span>get<span class="se">\&amp;</span><span class="nv">search</span><span class="o">=</span>user@protonmail.com<span class="w"> </span>-o<span class="w"> </span>user-pubkey.asc
</code></pre></div>

<p>Then import it into gpg</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="kn">import</span><span class="w"> </span><span class="nn">user</span><span class="o">-</span><span class="n">public</span><span class="o">.</span><span class="n">asc</span>
</code></pre></div>

<blockquote>
<p>Now you can decrypt their files and they can import your public pgp key from <a href="https://keys.openpgp.org">https://keys.openpgp.org</a> using your email address.</p>
</blockquote>
<p>Reference: <a href="https://proton.me/mail">https://proton.me/mail</a></p>
<h3 id="copy-keys-to-e-mail-client-host">Copy keys to e-mail client host</h3>
<p>Maybe you have a laptop for e-mail, while the gpg keys were created on a server. Here is how to copy the key(s).</p>
<p>Export public and secret key files</p>
<div class="highlight"><pre><span></span><code><span class="n">ID</span><span class="o">=</span><span class="n">bob</span><span class="err">@</span><span class="n">bob</span><span class="o">.</span><span class="n">com</span>
<span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="k">export</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">ID</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">public</span><span class="o">.</span><span class="n">key</span>
<span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="k">export</span><span class="o">-</span><span class="n">secret</span><span class="o">-</span><span class="n">key</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">ID</span><span class="p">}</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">private</span><span class="o">.</span><span class="n">key</span>
</code></pre></div>

<p>Copy to new host</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">scp</span><span class="w"> </span><span class="n">bob</span><span class="nv">@server</span><span class="err">:</span><span class="s1">&#39;/home/bob/gpg/bob.com/*.key&#39;</span><span class="w"> </span><span class="p">.</span>
</code></pre></div>

<p>Import into gpg on new host</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="kn">import</span><span class="w"> </span><span class="nn">public.key</span>
<span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="kn">import</span><span class="w"> </span><span class="nn">private.key</span>
</code></pre></div>

<p>Be sure to clean up the keys!</p>
<div class="highlight"><pre><span></span><code> rm public.key
 rm private.key
</code></pre></div>

<blockquote>
<p>You will need to verify the signature in your GUI E-Mail client, change it to 'verified' or 'accepted' to get full functionality. </p>
</blockquote>
<p>Now you can send/receive encrypted e-mail on the new host</p>
<p>Reference: </p>
<ul>
<li><a href="https://support.mozilla.org/en-US/kb/openpgp-thunderbird-howto-and-faq">https://support.mozilla.org/en-US/kb/openpgp-thunderbird-howto-and-faq</a></li>
<li><a href="https://www.openpgp.org/software/">https://www.openpgp.org/software/</a></li>
</ul>
<h3 id="revoke-certificate">Revoke Certificate</h3>
<p>If you forget your password or your private key is compromised, revoke the current certificate.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--output<span class="w"> </span>revoke.asc<span class="w"> </span>--gen-revoke<span class="w"> </span>user@example.com
$<span class="w"> </span>cp<span class="w"> </span>revoke.asc<span class="w">  </span>~/.gnupg/openpgp-revocs.d/revoke.rev
</code></pre></div>

<blockquote>
<p>Be sure to update the public key server and your fingerprints.</p>
</blockquote>
<h3 id="encryptdecrypt-a-file-with-a-key">Encrypt/decrypt a file with a key</h3>
<ul>
<li>Create a file to be mailed:</li>
</ul>
<p>File: junk</p>
<div class="highlight"><pre><span></span><code><span class="nx">To</span><span class="w"> </span><span class="nx">Whom</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">May</span><span class="w"> </span><span class="nx">Concern</span><span class="p">,</span>

<span class="nx">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">addressed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">party</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">I</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">contacted</span><span class="p">.</span>

<span class="nx">Regards</span><span class="p">,</span>
<span class="o">--</span><span class="w"> </span><span class="nx">Me</span>
</code></pre></div>

<ul>
<li>Encrypt your email file</li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--sign<span class="w"> </span>--armor<span class="w"> </span>--recipient<span class="w"> </span>bob@bob.com<span class="w"> </span>--encrypt<span class="w"> </span>junk
</code></pre></div>

<ul>
<li>Mail it</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="n">junk</span><span class="p">.</span><span class="k">asc</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mail</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="ss">&quot;Hello Bro&quot;</span><span class="w"> </span><span class="n">bob</span><span class="nv">@bob</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>

<ul>
<li>The other person can decrypt it (if they imported your public key)</li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--output<span class="w"> </span>junk-doc<span class="w"> </span>--decrypt<span class="w"> </span>junk.asc
</code></pre></div>

<blockquote>
<p>This is more secure if you do not share your public key on a public server. You just have to find a secure way to share it, like your own cloud server.</p>
</blockquote>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://lwn.net/">Linux Weekly News</a></li>
                            <li><a href="https://fullcirclemagazine.org/">Full Circle Magazine</a></li>
                            <li><a href="https://www.linuxjournal.com/">Linux Journal</a></li>
                            <li><a href="https://www.linux-magazine.com/">Linux Magazine</a></li>
                            <li><a href="https://www.thefarside.com/">The Far Side</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://dfcsoftware.github.io/linux-in-house/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://fosstodon.org/@LinuxintheHouse">Feedback</a></li>
                            <li><a href="https://fosstodon.org/@LinuxintheHouse.rss">Mastodon RSS feed</a></li>
                            <li><a href="https://linux-in-the-house.pages.dev/">Book</a></li>
                            <li><a href="/linux-in-house/author/don-cohoon.html">Created by: Don Cohoon</a></li>
                            <li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License </a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>
                Site by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, via <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </p><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                <p> Version:  3.81 </p>
        </footer><!-- /#contentinfo -->

</body>
</html>