<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>BeagleBone</title>
        <link rel="icon" type="image/svg" href="https://dfcsoftware.github.io/linux-in-house/images/favicon.svg">
        <link rel="stylesheet" href="https://dfcsoftware.github.io/linux-in-house/theme/css/main.css" type="text/css" />
        <!-- <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />  -->
        <link href="https://dfcsoftware.github.io/linux-in-house/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Linux Home Administration Atom Feed" />
        <meta name="description" content="BeagleBone Single Board Computer (SBC) The BeagleBone (BB) [1] line supports the Linux kernel and GPIO hardware connections to devices via device..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <table>
                    <td><h1><a href="https://dfcsoftware.github.io/linux-in-house/">Linux Home Administration</a></h1></td>
                    <td> <link href="/linux-in-house/pagefind/pagefind-ui.css" rel="stylesheet" type="text/css">
<script src="/linux-in-house/pagefind/pagefind-ui.js"></script>
<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script> </td>
                </table>
                <nav><ul>
                    <li class="active"><a href="https://dfcsoftware.github.io/linux-in-house/category/linux.html">linux</a></li>
                    <li><a href="https://dfcsoftware.github.io/linux-in-house/category/quest.html">quest</a></li>
                    <li><a href="https://dfcsoftware.github.io/linux-in-house/category/writing.html">writing</a></li>
                    <li><a href="https://dfcsoftware.github.io/linux-in-house/category/zines.html">zines</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://dfcsoftware.github.io/linux-in-house/beaglebone.html" rel="bookmark"
           title="Permalink to BeagleBone">BeagleBone</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-01-25T10:20:00-05:00">
                Published: Wed 25 January 2023
        </abbr>
		<br />
        <abbr class="modified" title="2024-04-19T09:30:00-04:00">
                Updated: Fri 19 April 2024
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://dfcsoftware.github.io/linux-in-house/author/don-cohoon.html">Don Cohoon</a>
        </address>
<p>In <a href="https://dfcsoftware.github.io/linux-in-house/category/linux.html">linux</a>.</p>
<p>tags: <a href="https://dfcsoftware.github.io/linux-in-house/tag/hardware.html">hardware</a> </p>
</footer><!-- /.post-info -->      <h1 id="beaglebone-single-board-computer-sbc">BeagleBone Single Board Computer (SBC)</h1>
<p>The BeagleBone (BB) [1] line supports the Linux kernel and GPIO hardware connections to devices via device trees [2]. It is simular to the Rasberry-PI line, only BB is <strong>open source hardware</strong>.</p>
<hr>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#beaglebone-single-board-computer-sbc">BeagleBone Single Board Computer (SBC)</a><ul>
<li><a href="#sbc-singlesmall-board-computer">SBC (Single/Small Board Computer)</a></li>
<li><a href="#serial-debug-connection">Serial Debug Connection</a><ul>
<li><a href="#bbai-64-adapter">BBAI-64 Adapter</a></li>
<li><a href="#screen-on-linux">Screen on Linux</a></li>
</ul>
</li>
<li><a href="#recover-from-lost-root-password">Recover from lost root password</a></li>
<li><a href="#flash-new-operating-system">Flash new Operating System</a><ul>
<li><a href="#boot-order">Boot Order</a><ul>
<li><a href="#bbai-32-devmmcblk0p1-micro-sd-devmmcblk1p1-on-board-mmc">BBAI-32 /dev/mmcblk0p1 = Micro-SD; /dev/mmcblk1p1 = On-board mmc</a></li>
<li><a href="#bbai-64-devmmcblk1p1-micro-sd-devmmcblk0p1-on-board-mmc">BBAI-64 /dev/mmcblk1p1 = Micro-SD; /dev/mmcblk0p1 = On-board mmc</a><ul>
<li><a href="#bb-ai-64-bit-uses-a-new-approach-extlinuxconf-1-that-will-probably-be-the-standard-going-forward-2">BB-AI 64-bit uses a new approach, extlinux.conf [1], that will probably be the standard going forward [2].</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#enable-flashing">Enable Flashing</a><ul>
<li><a href="#bbai-32-flash">BBAI-32: Flash</a></li>
<li><a href="#bbai-64-flash">BBAI-64: Flash</a></li>
</ul>
</li>
<li><a href="#flashing-process">Flashing Process</a></li>
<li><a href="#disable-flashing">Disable Flashing</a><ul>
<li><a href="#bb-ai-32-bit">BB-AI 32-Bit</a></li>
<li><a href="#bb-ai-64-bit">BB-AI 64-Bit</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#duplicate-micro-sd-card">Duplicate Micro-SD card</a></li>
<li><a href="#update-software">Update Software</a></li>
<li><a href="#expand-sd-filesystem">Expand SD filesystem</a></li>
<li><a href="#disable-cloud9-development-platform">Disable cloud9 development platform</a></li>
<li><a href="#bb-bbai-tether-system">bb-bbai-tether system</a></li>
<li><a href="#bbai-64-switches">BBAI-64 Switches</a></li>
<li><a href="#bbai-64-hdmi-display-connection">BBAI-64 HDMI Display Connection</a></li>
<li><a href="#bbai-64-default-memory-device-tree">BBAI-64 default memory device tree</a></li>
<li><a href="#bbai-64-fix-broken-boot">BBAI-64 Fix 'broken boot'</a></li>
<li><a href="#bbai-64-user-leds">BBAI-64 User LEDs</a></li>
<li><a href="#bbai-survival-guide">BBAI Survival Guide</a></li>
<li><a href="#real-time-clock-rtc-system-service-and-setup">Real Time Clock (RTC) system service and setup</a><ul>
<li><a href="#service-file">Service File</a></li>
<li><a href="#seven-segment-display">Seven Segment Display</a></li>
<li><a href="#clock-code">Clock Code</a></li>
</ul>
</li>
<li><a href="#music-player-for-the-car">Music Player for the Car</a><ul>
<li><a href="#installed-three-buttons">Installed three buttons</a></li>
<li><a href="#wiring-pins">Wiring Pins</a></li>
<li><a href="#service">Service</a></li>
<li><a href="#forward">Forward</a></li>
<li><a href="#play">Play</a></li>
<li><a href="#remote">Remote</a></li>
<li><a href="#remote-stop">Remote Stop</a></li>
<li><a href="#reverse">Reverse</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#power-onoff-another-pc">Power on/off another PC</a></li>
<li><a href="#reference">Reference</a></li>
<li><a href="#continue">Continue</a></li>
</ul>
</div>
<hr>
<h2 id="sbc-singlesmall-board-computer">SBC (Single/Small Board Computer)</h2>
<p>The BeagleBone (BB) [1] line supports the Linux kernel and GPIO hardware connections to devices via device trees [2]. It is simular to the Rasberry-PI line, only BB is <strong>open source hardware</strong>.</p>
<p>They run a full featured Debian distribution, capable of running C, C++, Rust, Python and node-js, all the way up to a PostgreSQL database. It comes with a web-based IDE called Cloud-9 [3] that can also run node-js programs on the BB. The AI line also supplies image recognition packages.</p>
<p>You can connect a display, keyboard and mouse, or run it headless. </p>
<p>All have USB connectors to ssh into from a connected computer, most have wired Ethernet RJ-45 sockets, and some have Bluetooth and WiFi. Controlling relays, lights, I2C sensors, and open switches can be done in most any supported language, even bash.</p>
<p>For robotics, they feature a Programmable real-time unit and industrial communications subsystem (PRU-ICSS) [4].</p>
<p>The forum for questions is here: <a href="https://forum.beagleboard.org/">https://forum.beagleboard.org/</a></p>
<p>For example:</p>
<ul>
<li>PocketBeagle  <a href="https://www.beagleboard.org/boards/pocketbeagle-original">https://www.beagleboard.org/boards/pocketbeagle-original</a></li>
<li><img alt="pocketBeagle-hero-hand-400x222.png" src="/linux-in-house/images/pocketBeagle-hero-hand-400x222.png"></li>
<li>This runs:<ul>
<li>Rebuilt Garfield clock with seven-segment-display and alarm, keeping track of daylight saving time changes.</li>
<li>Music box player.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>BBB (Black) <a href="https://www.beagleboard.org/boards/beaglebone-black">https://www.beagleboard.org/boards/beaglebone-black</a></li>
<li><img alt="beagle-black-wired-shadow_no5v-1-400x400.png" src="/linux-in-house/images/beagle-black-wired-shadow_no5v-1-400x400.png"></li>
<li>This runs very capabily:<ul>
<li>Music Player Daemon (MDP) [5]. You can control what is played on the command line or through a Phone App.</li>
<li>Control lights and relays. You can use the Python based Flask [6] package to create nice looking web apps for this.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>BBAI (AI 32-bit, arm71) <a href="https://www.beagleboard.org/boards/beaglebone-ai">https://www.beagleboard.org/boards/beaglebone-ai</a></li>
<li><img alt="beagleboane-ai-heatsink-500x356.png" src="/linux-in-house/images/beagleboane-ai-heatsink-500x356.png"></li>
<li>Applications I used with this include:<ul>
<li>NextCloud server (little slow).</li>
<li>Mini-Network Access Storage (NAS) with mirrored SSDs (mdadm).</li>
<li>HomeAssistant home automation (without cameras).</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>BBAI-64 (AI 64-bit; arm64) <a href="https://www.beagleboard.org/boards/beaglebone-ai-64">https://www.beagleboard.org/boards/beaglebone-ai-64</a></li>
<li><img alt="BeagleBone_AI_64-400x333.webp" src="/linux-in-house/images/BeagleBone_AI_64-400x333.webp"></li>
<li>Very good at:<ul>
<li>NextCloud server (runs good).</li>
<li>News Reader (MiniFlux).</li>
<li>Small web site.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>BeaglePlay is the latest offering (<a href="https://www.beagleboard.org/boards/beagleplay">https://www.beagleboard.org/boards/beagleplay</a>)</li>
<li><img alt="BeaglePlay-front-500x281.jpg" src="/linux-in-house/images/BeaglePlay.webp"></li>
<li>Quad Arm® Cortex®-A53 microprocessor subsystem @ 1.4GHz</li>
<li>Arm® Cortex®-M4F @ 400MHz</li>
<li>Dual-core PRU subsystem @ 333MHz</li>
<li>PowerVR® Rogue™ GPU</li>
</ul>
<p><strong>Features</strong>
  * Small 8cm x 8cm form-factor
  * 2GB RAM and 16GB on-board eMMC flash with high-speed interface
  * USB type-C for power and data and USB type-A host
  * Gigabit Ethernet, Single-pair Ethernet with PoDL
  * Integrated 2.4GHz and 5GHz WiFi
  * 2.4GHz and Sub-GHz programmable wireless MCU, integrated IEEE802.15.4 drivers/firmware
  * Full-size HDMI, OLDI, 4-lane CSI
  * Expansion via mikroBUS, Grove, QWIIC
  * Zero-download out-of-box software experience with Debian GNU/Linux</p>
<hr>
<ol>
<li><a href="https://www.beagleboard.org/">https://www.beagleboard.org/</a></li>
<li><a href="https://www.beagleboard.org/blog/2022-03-31-device-tree-supporting-similar-boards-the-beaglebone-example">https://www.beagleboard.org/blog/2022-03-31-device-tree-supporting-similar-boards-the-beaglebone-example</a></li>
<li><a href="https://github.com/c9">https://github.com/c9</a></li>
<li><a href="https://beagleboard.org/pru">https://beagleboard.org/pru</a></li>
<li><a href="https://www.musicpd.org/">https://www.musicpd.org/</a></li>
<li><a href="https://flask.palletsprojects.com/en/2.2.x/">https://flask.palletsprojects.com/en/2.2.x/</a></li>
</ol>
<h2 id="serial-debug-connection">Serial Debug Connection</h2>
<p>You can get through severe boot errors where the network is not connecting or disk partition not mounted, using a USB to TTL-232 cable [1], also called FTDI. This will show all the boot messages and allow login, even recovery if the kernel will not boot.</p>
<p><strong>Make sure it is 3.3 volt!</strong> Connect the black wire to pin 1, orange/green to pin 4, yellow/white to pin5 directly on the SBC board.</p>
<p><img alt="AU51n75Ls0JwfPeYMD6sIQ-547387362.png" src="/linux-in-house/images/AU51n75Ls0JwfPeYMD6sIQ-547387362.png"></p>
<ul>
<li>
<p>USB to TTL cable</p>
</li>
<li>
<p><a href="https://www.adafruit.com/product/4331">https://www.adafruit.com/product/4331</a>. </p>
</li>
</ul>
<p><img alt="28W2088-40.webp" src="/linux-in-house/images/28W2088-40.webp"></p>
<h4 id="bbai-64-adapter">BBAI-64 Adapter</h4>
<p>The BBAI-64 has a 3-pin connector so it needs an adapter; Micro JST MX 1.25 4Pins Connector Plug Socket 1.25mm Pitch Female Connector PCB Socket 150mm Cable. The red wire is not used. Plug the other three wires into the USB/TTL adapter above, matching colors.</p>
<p><img alt="Screen Shot 2022-10-22 at 9.18.32 AM.png" src="/linux-in-house/images/Screen%20Shot%202022-10-22%20at%209.18.32%20AM.png"></p>
<h4 id="screen-on-linux">Screen on Linux</h4>
<p>When you have connected USB-end of the serial cable to a Linux based system like Ubuntu, a new tty* device appears in the system. Note down its name. In my case, it was <em>/dev/ttyUSB0</em>. Open a term and issue below command</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>screen<span class="w"> </span>/dev/ttyUSB0<span class="w"> </span><span class="m">115200</span>
</code></pre></div>

<blockquote>
<p>Do <strong>ls /dev/</strong> before and after connecting cable to find the new device name</p>
</blockquote>
<p>You may have to reboot the PC and BB after connection to clear garbled characters.</p>
<h2 id="recover-from-lost-root-password">Recover from lost root password</h2>
<p>Flash a new mini-sd card and boot off of it, then:</p>
<ol>
<li>Mount the eMMC flash:  mount /dev/mmcblk1p2 /media/card</li>
<li>Change the root of the file system to be the partition on the eMMC flash which you just mounted: chroot /media/card</li>
<li>Change the password of the root user to something you know: passwd root</li>
<li>Exit out of the changed root: exit</li>
<li>Shutdown the BeagleBone Black : shutdown -h now</li>
<li>Disconnect the power from the board</li>
<li>Eject the microSD card.</li>
<li>Reconnect the power to the board</li>
<li>Watch the board boot up, and log in as root. You should be able to log in with the password that you just set.</li>
</ol>
<h2 id="flash-new-operating-system">Flash new Operating System</h2>
<p>Latest software: <a href="https://www.beagleboard.org/distros">https://www.beagleboard.org/distros</a></p>
<p>Flashing refers to  the process of transferring the Operating System image from a Micro-SD card to the on-board mmc memory disk.</p>
<p>WARNING: It will <strong>overlay</strong> the contents of your BBB soldered in mmc memory.</p>
<blockquote>
<p>Be aware that the on-board mmc is only 15GB, so flashing an SD card with a <strong>partition</strong> larger than 15GB will fail with out of space. </p>
</blockquote>
<h3 id="boot-order">Boot Order</h3>
<p>The BB-AI 32-bit has a different disk device naming convention than 64-bit ;-)</p>
<h4 id="bbai-32-devmmcblk0p1-micro-sd-devmmcblk1p1-on-board-mmc">BBAI-32 /dev/mmcblk0p1 = Micro-SD; /dev/mmcblk1p1 = On-board mmc</h4>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>inxi<span class="w"> </span>-D
Drives:<span class="w">    </span>Local<span class="w"> </span>Storage:<span class="w"> </span>total:<span class="w"> </span><span class="m">1005</span>.80<span class="w"> </span>GiB<span class="w"> </span>used:<span class="w"> </span><span class="m">338</span>.77<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">33</span>.7%<span class="o">)</span><span class="w"> </span>
<span class="w">           </span>ID-1:<span class="w"> </span>/dev/mmcblk0<span class="w"> </span>model:<span class="w"> </span>BC1S5<span class="w"> </span>size:<span class="w"> </span><span class="m">59</span>.69<span class="w"> </span>GiB<span class="w"> </span>
<span class="w">           </span>ID-2:<span class="w"> </span>/dev/mmcblk1<span class="w"> </span>model:<span class="w"> </span>TB2916<span class="w"> </span>size:<span class="w"> </span><span class="m">14</span>.60<span class="w"> </span>GiB<span class="w"> </span>
...
</code></pre></div>

<p>See how cleverly the number 0 uses the natural Linux boot ordering.</p>
<h4 id="bbai-64-devmmcblk1p1-micro-sd-devmmcblk0p1-on-board-mmc">BBAI-64 /dev/mmcblk1p1 = Micro-SD; /dev/mmcblk0p1 = On-board mmc</h4>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>inxi<span class="w"> </span>-D
Drives:<span class="w">    </span>Local<span class="w"> </span>Storage:<span class="w"> </span>total:<span class="w"> </span>raw:<span class="w"> </span><span class="m">1</span>.92<span class="w"> </span>TiB<span class="w"> </span>usable:<span class="w"> </span><span class="m">1</span>.01<span class="w"> </span>TiB<span class="w"> </span>used:<span class="w"> </span><span class="m">156</span>.93<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">15</span>.2%<span class="o">)</span><span class="w"> </span>
<span class="w">           </span>ID-1:<span class="w"> </span>/dev/mmcblk0<span class="w"> </span>vendor:<span class="w"> </span>Kingston<span class="w"> </span>model:<span class="w"> </span>TB2916<span class="w"> </span>size:<span class="w"> </span><span class="m">14</span>.6<span class="w"> </span>GiB<span class="w"> </span>
<span class="w">           </span>ID-2:<span class="w"> </span>/dev/mmcblk1<span class="w"> </span>model:<span class="w"> </span>BC1S5<span class="w"> </span>size:<span class="w"> </span><span class="m">59</span>.69<span class="w"> </span>GiB<span class="w"> </span>
...
</code></pre></div>

<h5 id="bb-ai-64-bit-uses-a-new-approach-extlinuxconf-1-that-will-probably-be-the-standard-going-forward-2">BB-AI 64-bit uses a new approach, extlinux.conf [1], that will probably be the standard going forward [2].</h5>
<p>Here it is set to boot from mmcblk1p2.</p>
<p>File: /boot/firmware/extlinux/extlinux.conf </p>
<div class="highlight"><pre><span></span><code><span class="nx">label</span><span class="w"> </span><span class="nx">Linux</span><span class="w"> </span><span class="nx">microSD</span>
<span class="w">    </span><span class="nx">kernel</span><span class="w"> </span><span class="o">/</span><span class="nx">Image</span>
<span class="w">    </span><span class="nx">fdt</span><span class="w"> </span><span class="o">/</span><span class="nx">k3</span><span class="o">-</span><span class="nx">j721e</span><span class="o">-</span><span class="nx">beagleboneai64</span><span class="o">-</span><span class="nx">no</span><span class="o">-</span><span class="nx">shared</span><span class="o">-</span><span class="nx">mem</span><span class="p">.</span><span class="nx">dtb</span>
<span class="w">    </span><span class="nx">append</span><span class="w"> </span><span class="nx">console</span><span class="p">=</span><span class="nx">ttyS2</span><span class="p">,</span><span class="mi">115200</span><span class="nx">n8</span><span class="w"> </span><span class="nx">earlycon</span><span class="p">=</span><span class="nx">ns16550a</span><span class="p">,</span><span class="nx">mmio32</span><span class="p">,</span><span class="mh">0x02800000</span><span class="w"> </span><span class="nx">root</span><span class="p">=</span><span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">mmcblk1p2</span><span class="w"> </span><span class="nx">ro</span><span class="w"> </span><span class="nx">rootfstype</span><span class="p">=</span><span class="nx">ext4</span><span class="w"> </span><span class="nx">rootwait</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">ifnames</span><span class="p">=</span><span class="mi">0</span>
<span class="w">    </span><span class="nx">fdtdir</span><span class="w"> </span><span class="o">/</span>
<span class="w">    </span><span class="nx">initrd</span><span class="w"> </span><span class="o">/</span><span class="nx">initrd</span><span class="p">.</span><span class="nx">img</span>
</code></pre></div>

<blockquote>
<p>On the BBAI-64, by default we are using U-Boot’s now (finally) standard extlinux.conf, you’ll find it in the first fat partition of either the eMMC or microSD… (I have a long term goal to convert our custom “am335x/am57xx” uEnv.txt solution to extlinux.conf…) [2]</p>
</blockquote>
<p>Reference:</p>
<ol>
<li><a href="https://wiki.syslinux.org/wiki/index.php?title=EXTLINUX">https://wiki.syslinux.org/wiki/index.php?title=EXTLINUX</a></li>
<li><a href="https://forum.beagleboard.org/t/bbai-64-boot-order/33129">https://forum.beagleboard.org/t/bbai-64-boot-order/33129</a></li>
</ol>
<h3 id="enable-flashing">Enable Flashing</h3>
<h4 id="bbai-32-flash">BBAI-32: Flash</h4>
<ul>
<li>
<p>For example, download and burn a Micro-SD card, BBAI (32-bit) flasher: <a href="https://www.beagleboard.org/distros">https://www.beagleboard.org/distros</a></p>
</li>
<li>
<p>Burn the download file to a Micro-SD, normally using Etcher <a href="https://etcher.balena.io">https://etcher.balena.io</a></p>
</li>
<li>
<p>Turn off the BBB, insert the SD card and apply power.</p>
</li>
<li>
<p>This will copy the <strong>boot files</strong> on top of the mmc on-board disk,</p>
</li>
</ul>
<p>If  you start with the non-flasher and verify that it will boot, THEN edit the </p>
<div class="highlight"><pre><span></span><code>/boot/uEnv.txt 
</code></pre></div>

<p>file to activate (un-comment) the flasher script (last line in the file) and reboot the device to flash it.</p>
<p>File: /boot/uEnv.txt </p>
<div class="highlight"><pre><span></span><code>##enable Generic eMMC Flasher:
cmdline=init=/usr/sbin/init-beagle-flasher
</code></pre></div>

<h4 id="bbai-64-flash">BBAI-64: Flash</h4>
<div class="highlight"><pre><span></span><code><span class="k">*</span> To flash a microSD to eMMC:
</code></pre></div>

<p>Run:</p>
<div class="highlight"><pre><span></span><code>sudo apt update ; sudo apt upgrade
sudo beagle-flasher
</code></pre></div>

<p>Or to create a dedicated flasher:</p>
<div class="highlight"><pre><span></span><code>sudo apt update ; sudo apt upgrade
sudo enable-beagle-flasher
sudo reboot
</code></pre></div>

<p>Reference: <a href="https://forum.beagleboard.org/t/ai-64-how-to-flash-emmc/32384/2">https://forum.beagleboard.org/t/ai-64-how-to-flash-emmc/32384/2</a></p>
<h3 id="flashing-process">Flashing Process</h3>
<p>You will see the lights doing a bouncing flash; 1,2,3,4 - 4,3,2,1 - etc… for several minutes,
eventually it will turn itself off. Then pop out the SD card and re-apply power to boot up the newly flashed on-board mmc.</p>
<h3 id="disable-flashing">Disable Flashing</h3>
<p>After booting the newly flashed on-board mmc;</p>
<h4 id="bb-ai-32-bit">BB-AI 32-Bit</h4>
<ol>
<li>mount the SD card: </li>
</ol>
<div class="highlight"><pre><span></span><code>sudo mount /dev/mmcblk0p1 /media/card
</code></pre></div>

<ol>
<li>Comment out the ‘flashing’ line in uEnv.txt like this:</li>
</ol>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tail<span class="w"> </span>/media/card/boot/uEnv.txt<span class="w"> </span>
...
<span class="c1">##enable Generic eMMC Flasher:</span>
<span class="c1">#cmdline=init=/usr/sbin/init-beagle-flasher</span>
</code></pre></div>

<ol>
<li>It is now safe to boot off the SD card! Push it back in and it will be selected during the boot process, before the mmc.</li>
</ol>
<blockquote>
<p>I usually boot onto the Micro-SD and run that way. If it fails you can always remove it and <strong>still</strong> have a bootable environment.</p>
</blockquote>
<h4 id="bb-ai-64-bit">BB-AI 64-Bit</h4>
<p>Disable a dedicated flasher, download the latest <strong>non-flasher</strong> and re-burn the Micro-SD card.</p>
<p>To Check, mount it on a PC and look at directory :</p>
<p>File: \&lt;mount point&gt;/boot/firmware/extlinux/extlinux.conf </p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="w">    </span><span class="nx">append</span><span class="w"> </span><span class="nx">console</span><span class="p">=</span><span class="nx">ttyS2</span><span class="p">,</span><span class="mi">115200</span><span class="nx">n8</span><span class="w"> </span><span class="nx">earlycon</span><span class="p">=</span><span class="nx">ns16550a</span><span class="p">,</span><span class="nx">mmio32</span><span class="p">,</span><span class="mh">0x02800000</span><span class="w"> </span><span class="nx">root</span><span class="p">=</span><span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">mmcblk1p2</span><span class="w"> </span><span class="nx">ro</span><span class="w"> </span><span class="nx">rootfstype</span><span class="p">=</span><span class="nx">ext4</span><span class="w"> </span><span class="nx">rootwait</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">ifnames</span><span class="p">=</span><span class="mi">0</span>
<span class="o">...</span>
</code></pre></div>

<p>Above shows a <strong>normal</strong> boot file. A flasher will point to a beagle-flasher image to boot onto.</p>
<h2 id="duplicate-micro-sd-card">Duplicate Micro-SD card</h2>
<p>It is a good idea to backup the active Micro0SD card after all your hard work. Re-imaging and installing all the packages is a pain!</p>
<p>This process will copy <strong>everything</strong> on the SD card, even blank data. So a 64GB card will make a 64GB img file. Your destination card must be at least as big as the original.</p>
<p>Insert the original SD card and check the name of the device (usually mmcblkX or sdcX):</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>lsblkid<span class="w"> </span>-a
...
mmcblk0<span class="w">     </span><span class="m">179</span>:0<span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">59</span>.7G<span class="w">  </span><span class="m">0</span><span class="w"> </span>disk<span class="w">  </span>
├─mmcblk0p1<span class="w"> </span><span class="m">179</span>:1<span class="w">    </span><span class="m">0</span><span class="w">   </span>128M<span class="w">  </span><span class="m">0</span><span class="w"> </span>part<span class="w">  </span>/media/don/BOOT
└─mmcblk0p2<span class="w"> </span><span class="m">179</span>:2<span class="w">    </span><span class="m">0</span><span class="w">  </span><span class="m">59</span>.6G<span class="w">  </span><span class="m">0</span><span class="w"> </span>part<span class="w">  </span>/media/don/rootfs
</code></pre></div>

<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>fdisk<span class="w"> </span>-l
...
Device<span class="w">         </span>Boot<span class="w">   </span>Start<span class="w">      </span>End<span class="w">  </span>Sectors<span class="w">  </span>Size<span class="w"> </span>Id<span class="w"> </span>Type
/dev/mmcblk0p1<span class="w"> </span>*<span class="w">       </span><span class="m">2048</span><span class="w">  </span><span class="m">2099199</span><span class="w">  </span><span class="m">2097152</span><span class="w">    </span>1G<span class="w">  </span>c<span class="w"> </span>W95<span class="w"> </span>FAT32<span class="w"> </span><span class="o">(</span>LBA<span class="o">)</span>
/dev/mmcblk0p2<span class="w">      </span><span class="m">2099200</span><span class="w"> </span><span class="m">31116287</span><span class="w"> </span><span class="m">29017088</span><span class="w"> </span><span class="m">13</span>.9G<span class="w"> </span><span class="m">83</span><span class="w"> </span>Linux
</code></pre></div>

<p>In my case the SD card is /dev/mmcblk0 (the <em>p1 and </em>p2 are the partitions).</p>
<p>You have to unmount the devices:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>umount<span class="w"> </span>/dev/mmcblk0p1
$<span class="w"> </span>sudo<span class="w"> </span>umount<span class="w"> </span>/dev/mmcblk0p2
</code></pre></div>

<p>To create an image of the device:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/mmcblk0<span class="w"> </span><span class="nv">of</span><span class="o">=</span>~/sd-card-copy.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress
</code></pre></div>

<p>This will take a while.</p>
<p>Once it's finished, insert the empty SD card. If the device is different (USB or other type of SD card reader) verify its name and be sure to unmount it:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>fdisk<span class="w"> </span>-l
$<span class="w"> </span>sudo<span class="w"> </span>umount<span class="w"> </span>/dev/mmcblk0p1
$<span class="w"> </span>sudo<span class="w"> </span>umount<span class="w"> </span>/dev/mmcblk0p2
</code></pre></div>

<p>Write the image to the device:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>~/sd-card-copy.img<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/mmcblk0<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress
</code></pre></div>

<p>The write operation is much slower than before.</p>
<h2 id="update-software">Update Software</h2>
<p><strong>Update examples in the Cloud9 IDE workspace</strong></p>
<p>cd /var/lib/cloud9<br>
git pull<br>
...<br>
<strong>Update the boot-up scripts and Linux kernel</strong></p>
<p>cd /opt/scripts<br>
git pull</p>
<p><strong>Update Kernel</strong></p>
<p>cd /opt/scripts<br>
sudo tools/update_kernel.sh</p>
<h2 id="expand-sd-filesystem">Expand SD filesystem</h2>
<p>Sometimes when you burn an .iso image to the SD card and boot up the BB, the filesystem will be 4GB while your SD card could be 32GB. </p>
<p>This script will expand the filesystem after your first boot up onto it.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>/opt/scripts/tools/grow_partition.sh
</code></pre></div>

<ul>
<li>If the script is not available, use this:</li>
</ul>
<p>Examine the partitioning on your external SD card:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/mmcblk0
</code></pre></div>

<p>Then enter 'p', An important value to note is the start sector of the Linux partition, enter 'd' to delete the Linux partition. (If you have two partitions it will ask which partition to delete, which should be 2.).</p>
<p>Enter 'n' to create a new partition. For the first two questions (partition type and number) just press enter. For the start sector, be absolutely sure to use the same number it had originally. For the last sector, you can use whatever you want in case you don't want to use your whole micro SD, but you can just hit enter to use the default (the max size possible). </p>
<p>If you are satisfied with your changes at this point you can enter 'w' to commit to your changes. </p>
<blockquote>
<p>A warning above will appear if you're repartitioning the disk you've booted from. In that case, reboot your system</p>
</blockquote>
<p>Lastly, after your BeagleBone Black reboots, you need to expand the file system. Before expanding you need to run fsck as root, otherwise next command will fail to run:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>fsck<span class="w"> </span>/dev/mmcblk0p1
</code></pre></div>

<p>Finally, run the following command (again as root):</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/mmcblk0p1
</code></pre></div>

<p>Once this command completes, you're done! </p>
<p>Reference:</p>
<ul>
<li>
<p><a href="https://github.com/RobertCNelson/boot-scripts/blob/master/tools/grow_partition.sh">https://github.com/RobertCNelson/boot-scripts/blob/master/tools/grow_partition.sh</a></p>
</li>
<li>
<p><a href="https://elinux.org/Beagleboard:Expanding_File_System_Partition_On_A_microSD">https://elinux.org/Beagleboard:Expanding_File_System_Partition_On_A_microSD</a></p>
</li>
</ul>
<h2 id="disable-cloud9-development-platform">Disable cloud9 development platform</h2>
<p>This allows over the web programming on the system, which is a security risk if not being used.</p>
<p>Disable:</p>
<div class="highlight"><pre><span></span><code>systemctl disable cloud9.service
systemctl disable bonescript.service
systemctl disable bonescript.socket
systemctl disable bonescript-autorun.service
</code></pre></div>

<p>Example of service file</p>
<div class="highlight"><pre><span></span><code><span class="na">debian@pocketbeagle:~$ cat /lib/systemd/system/cloud9.service </span>
<span class="na">[Unit] </span>
<span class="na">Description</span><span class="o">=</span><span class="s">Cloud9 IDE </span>
<span class="na">ConditionPathExists</span><span class="o">=</span><span class="s">|/var/lib/cloud9 </span>

<span class="na">[Service] </span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/opt/cloud9/build/standalonebuild </span>
<span class="na">EnvironmentFile</span><span class="o">=</span><span class="s">/etc/default/cloud9 </span>
<span class="na">ExecStartPre</span><span class="o">=</span><span class="s">/opt/cloud9/cloud9-symlink </span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/nodejs server.js --packed -w /var/lib/cloud9 SyslogIdentifier=cloud9ide </span>
<span class="na">User</span><span class="o">=</span><span class="s">1000 </span>
</code></pre></div>

<h2 id="bb-bbai-tether-system">bb-bbai-tether system</h2>
<p>This is used to connect your device/PC to =&gt; BB-AI and BBB over WiFi.</p>
<blockquote>
<p>BBAI-64 uses systemd-networkd [1] (files: /etc/systemd/network/*)</p>
</blockquote>
<p>Config file: /etc/default/bb-wl18xx</p>
<div class="highlight"><pre><span></span><code># TETHER_ENABLED: Whether or not to run the /usr/bin/bb-wl18xx-tether daemon; set to no to disable.
#TETHER_ENABLED=yes
TETHER_ENABLED=no

# USE_CONNMAN_TETHER: Whether or not to just use connman tether inteface; set to no to disable.
USE_CONNMAN_TETHER=no

# USE_WL18XX_IP_PREFIX: default IP block of SoftAP0 interface
USE_WL18XX_IP_PREFIX=&quot;192.168.18&quot;

# USE_INTERNAL_WL18XX_MAC_ADDRESS: use internal mac address; set to no to disable.
USE_INTERNAL_WL18XX_MAC_ADDRESS=yes

# USE_WL18XX_MAC_ADDRESS: use custom mac address, for when work wifi starts sending deauthentication packet spam.
#USE_WL18XX_MAC_ADDRESS=&quot;AB:10:23:C:16:78&quot;

# USE_WL18XX_POWER_MANAGMENT: (sudo iwconfig wlan0 power [on/off]). on = boot default, off is more reliable for accessing idle systems over time
USE_WL18XX_POWER_MANAGMENT=off

# USE_PERSONAL_SSID: set custom ssid
#USE_PERSONAL_SSID=&quot;BeagleBone&quot;
USE_PERSONAL_SSID=&quot;AB10&quot;

# USE_PERSONAL_PASSWORD: set ssid password
USE_PERSONAL_PASSWORD=&quot;BeagleBone&quot;

# USE_GENERATED_DNSMASQ: use generated version of /etc/dnsmasq.d/SoftAp0; set to no so user can modify /etc/dnsmasq.d/SoftAp0
USE_GENERATED_DNSMASQ=yes

# USE_GENERATED_HOSTAPD: use generated version of /etc/hostapd.conf; set to no so user can modify /etc/hostapd.conf
USE_GENERATED_HOSTAPD=yes

# USE_APPENDED_SSID: appends mac address after SSID (aka -WXYZ, BeagleBone-WXYZ)
USE_APPENDED_SSID=yes

# USE_PERSONAL_COUNTRY: (default is US, but note enabled (#) with comment) 
#USE_PERSONAL_COUNTRY=US
</code></pre></div>

<p>Service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl status bb-bbai-tether 
● bb-bbai-tether.service - BBAI brcmfmac tether Service
    Loaded: loaded (/lib/systemd/system/bb-bbai-tether.service; enabled; vendor preset: enabled)
    Active: activating (start) since Sun 2022-09-04 12:19:48 EDT; 16s ago 
Cntrl PID: 2585 (bb-bbai-tether)
     Tasks: 2 (limit: 937)
    Memory: 752.0K
    CGroup: /system.slice/bb-bbai-tether.service
            ├─2585 /bin/bash -e /usr/bin/bb-bbai-tether
            └─2605 sleep 5 Sep 04 12:19:48 bbb.example.com systemd[1]: Starting BBAI brcmfmac tether Service... 
Sep 04 12:19:53 bbb.example.com bb-bbai-tether[2585]: bbai:tether waiting for /sys/class/net/wlan0 
Sep 04 12:19:58 bbb.example.com bb-bbai-tether[2585]: bbai:tether waiting for /sys/class/net/wlan0 
Sep 04 12:20:03 bbb.example.com bb-bbai-tether[2585]: bbai:tether waiting for /sys/class/net/wlan0 
don@app:~$ sudo systemctl stop bb-bbai-tether
</code></pre></div>

<ol>
<li><a href="https://wiki.debian.org/SystemdNetworkd">https://wiki.debian.org/SystemdNetworkd</a></li>
</ol>
<h2 id="bbai-64-switches">BBAI-64 Switches</h2>
<p>Push-buttons used on the board.</p>
<ol>
<li>A switch is provided to allow switching between the modes.</li>
<li>Holding the boot switch down during a removal and reapplication of power without a microSD card inserted will force the boot source to be the USB port and if nothing is detected on the USB client port, it will go to the serial port for download.</li>
<li>Without holding the switch, the board will boot try to boot from the eMMC. If it is empty, then it will try booting from the microSD slot, followed by the serial port, and then the USB port.</li>
<li>
<p>If you hold the boot switch down during the removal and reapplication of power to the board, and you have a microSD card inserted with a bootable image, the board will boot from the microSD card.</p>
<p><em>NOTE: Pressing the RESET button on the board will NOT result in a change of the boot mode. You MUST remove power and reapply power to change the boot mode. The boot pins are sampled during power on reset from the PMIC to the processor. The reset button on the board is a warm reset only and will not force a boot mode change.</em></p>
</li>
</ol>
<h2 id="bbai-64-hdmi-display-connection">BBAI-64 HDMI Display Connection</h2>
<p>When connecting to an HDMI monitor, make sure your miniDP adapter is <em>active</em>. A <em>passive</em> adapter will not work. See <a href="https://docs.beagleboard.org/latest/boards/beaglebone/ai-64/ch03.html#display-adaptors-figure">Fig: Display adaptors</a>.</p>
<h2 id="bbai-64-default-memory-device-tree">BBAI-64 default memory device tree</h2>
<p>Reference: <a href="https://forum.beagleboard.org/t/beaglebone-ai-64-memory-4gb-or-2gb-ram/32270%EF%BF%BC">https://forum.beagleboard.org/t/beaglebone-ai-64-memory-4gb-or-2gb-ram/32270</a></p>
<p>the AI-64 has 4GB installed, the other 2GB is reserved in the default image thru remoteproc for the other companion cores (c6, c7x, and R5)…</p>
<p>We have a custom device tree for you if you’d like to disable the other cores and use all 4GB with the A72’s…</p>
<div class="highlight"><pre><span></span><code>=&gt; No Shared Memory =&gt; k3-j721e-beagleboneai64-no-shared-mem.dtb

debian@BeagleBone:~$ sudo find /boot/ -name extlinux.conf
/boot/firmware/extlinux/extlinux.conf

debian@BeagleBone:~$ sudo ls /boot/firmware
extlinux  Image       k3-j721e-beagleboneai64.dtb         k3-j721e-common-proc-board.dtb    k3-j721e-sk.dtb  sysfw.itb     tispl.bin
ID.txt      initrd.img  k3-j721e-beagleboneai64-no-shared-mem.dtb  k3-j721e-proc-board-tps65917.dtb  overlays        tiboot3.bin  u-boot.img

..
</code></pre></div>

<p>so in /boot/firmware/extlinux/extlinux.conf just set:</p>
<div class="highlight"><pre><span></span><code>fdt /k3-j721e-beagleboneai64-no-shared-mem.dtb
</code></pre></div>

<p>take it out to go back to sharing memory for PRU.</p>
<div class="highlight"><pre><span></span><code>$ cat /boot/firmware/extlinux/extlinux.conf 
label Linux microSD
    kernel /Image
    fdt /k3-j721e-beagleboneai64-no-shared-mem.dtb
    append console=ttyS2,115200n8 earlycon=ns16550a,mmio32,0x02800000 root=/dev/mmcblk1p2 ro rootfstype=ext4 rootwait net.ifnames=0
    fdtdir /
    initrd /initrd.img
</code></pre></div>

<h2 id="bbai-64-fix-broken-boot">BBAI-64 Fix 'broken boot'</h2>
<p>Finger on both boot and reset:<br>
Insert power<br>
lift finger on reset<br>
wait till led lights<br>
lift finger on boot.</p>
<p>Since you have the serial boot log, stop u-boot with the “space” key…</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> run emmc_erase_boot0
</code></pre></div>

<p>=&gt; Reboot with SD card inserted, newly burned image: bbai64-debian-11.3-xfce-arm64-2022-06-14-10gb.img.xz</p>
<div class="highlight"><pre><span></span><code>$ sudo apt update

$ sudo apt upgrade

debian@BeagleBone:~$ sudo /opt/u-boot/bb-u-boot-beagleboneai64/install-emmc.sh
Changing ext_csd[BOOT_BUS_CONDITIONS] from 0x02 to 0x02
H/W Reset is already permanently enabled on /dev/mmcblk0
Clearing eMMC boot0
dd if=/dev/zero of=/dev/mmcblk0boot0 count=32 bs=128k
32+0 records in
32+0 records out
4194304 bytes (4.2 MB, 4.0 MiB) copied, 0.549462 s, 7.6 MB/s
dd if=/opt/u-boot/bb-u-boot-beagleboneai64/tiboot3.bin of=/dev/mmcblk0boot0 bs=128k
2+1 records in
2+1 records out
283940 bytes (284 kB, 277 KiB) copied, 1.13585 s, 250 kB/s
debian@BeagleBone:~$ sudo /opt/u-boot/bb-u-boot-beagleboneai64/install-microsd.sh
&#39;/opt/u-boot/bb-k3-image-gen-j721e-evm/sysfw.itb&#39; -&gt; &#39;/boot/firmware/sysfw.itb&#39;
&#39;/opt/u-boot/bb-u-boot-beagleboneai64/tiboot3.bin&#39; -&gt; &#39;/boot/firmware/tiboot3.bin&#39;
&#39;/opt/u-boot/bb-u-boot-beagleboneai64/tispl.bin&#39; -&gt; &#39;/boot/firmware/tispl.bin&#39;
&#39;/opt/u-boot/bb-u-boot-beagleboneai64/u-boot.img&#39; -&gt; &#39;/boot/firmware/u-boot.img&#39;

$ sudo reboot 
</code></pre></div>

<p>=&gt; Login</p>
<div class="highlight"><pre><span></span><code>$ uname -a

Linux BeagleBone 5.10.120-ti-arm64-r50 #1bullseye SMP PREEMPT Tue Jun 28 20:37:27 UTC 2022 aarch64 GNU/Linux

$ df -h
Filesystem      Size  Used Avail Use% Mounted on
udev            1.8G     0  1.8G   0% /dev
tmpfs           371M  2.0M  369M   1% /run
/dev/mmcblk1p2   59G  9.7G   47G  18% /
tmpfs           1.9G   16K  1.9G   1% /dev/shm
tmpfs           5.0M  4.0K  5.0M   1% /run/lock
/dev/mmcblk1p1  127M   47M   80M  38% /boot/firmware
</code></pre></div>

<h2 id="bbai-64-user-leds">BBAI-64 User LEDs</h2>
<table>
<thead>
<tr>
<th>LED</th>
<th>GPIO Signal</th>
<th>Default Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>D2</td>
<td>GPIO3_17</td>
<td>Heartbeat when Linux is running</td>
</tr>
<tr>
<td>D3</td>
<td>GPIO5_5</td>
<td>microSD Activity</td>
</tr>
<tr>
<td>D4</td>
<td>GPIO3_15</td>
<td>CPU Activity</td>
</tr>
<tr>
<td>D5</td>
<td>GPIO3_14</td>
<td>eMMC Activity</td>
</tr>
<tr>
<td>D8</td>
<td>GPIO3_7</td>
<td>WiFi/Bluetooth Activity</td>
</tr>
</tbody>
</table>
<p><img alt="BB_AI_USERLEDS_800px.png" src="/linux-in-house/images/BB_AI_USERLEDS_800px.png"></p>
<h2 id="bbai-survival-guide">BBAI Survival Guide</h2>
<p><a href="https://community.element14.com/challenges-projects/project14/visionthing/b/blog/posts/beaglebone-ai-survival-guide-v3-18-pwm-i2c-analog-digital-read-write-vision-ai-video-text-overlays-audio-hardware">https://community.element14.com/challenges-projects/project14/visionthing/b/blog/posts/beaglebone-ai-survival-guide-v3-18-pwm-i2c-analog-digital-read-write-vision-ai-video-text-overlays-audio-hardware</a></p>
<h2 id="real-time-clock-rtc-system-service-and-setup">Real Time Clock (RTC) system service and setup</h2>
<p>Any clock needs to keep it's time when the power goes out. Since the PocketBeagle is not always connected to WiFi to sync with Network Time Services, we will install a Real Time Clock with a small battery [1].</p>
<blockquote>
<p>Real Time Clock setup using i2c, ExploringBB: pp350 [1]</p>
</blockquote>
<p>Here is the wiring diagram for a PocketBeagle:</p>
<ul>
<li>PocketBeagle &lt;-&gt; DS3231 RTC</li>
<li>
<p>I2C1:</p>
<ul>
<li>Pin 14     -  VCC</li>
<li>Pin 16     -  GND</li>
<li>Pin 9      -  SCL</li>
<li>Pin 11     -  SDA</li>
</ul>
</li>
<li>
<p><a href="https://learn.adafruit.com/adafruit-ds3231-precision-rtc-breakout/overview">https://learn.adafruit.com/adafruit-ds3231-precision-rtc-breakout/overview</a></p>
</li>
</ul>
<p>Setup procedure:</p>
<div class="highlight"><pre><span></span><code>$ sudo apt install i2c-tools
$ i2cdetect
$ i2cdump -y 1 0x68 b
$ hwclock -r -f /dev/rtc1 
# (Note: rtc0 is active on-board)

$ sudo modprobe rtc-ds1307
$ sudo /bin/sh -c &quot;/bin/echo ds1307 0x68 &gt; /sys/class/i2c-adapter/i2c-1/new_device&quot;
#  Now /dev/rtc1 should show up, echo delete_device to remove it.

# hwclock -r (read)
# hwclock -w (write)
# hwclock -s (set RTC to system time)
$ hwclock --set --date &quot;2019-01-01 00:00:00&quot; 
# (set new time)

$ sudo systemctl enable hwclock.service
$ sudo systemctl status hwclock.service
$ reboot
</code></pre></div>

<ol>
<li><a href="http://derekmolloy.ie/exploring-beaglebone-tools-and-techniques-for-building-with-embedded-linux/">http://derekmolloy.ie/exploring-beaglebone-tools-and-techniques-for-building-with-embedded-linux/</a></li>
</ol>
<h3 id="service-file">Service File</h3>
<p>File: /etc/systemd/system/clock.service</p>
<div class="highlight"><pre><span></span><code>[Unit]

Description=RTC Service
Before=getty.target

[Service]
Type=oneshot
ExecStartPre=/bin/sh -c &quot;/bin/echo ds1307 0x68 &gt; /sys/class/i2c-adapter/i2c-1/new_device&quot;
ExecStart=/sbin/hwclock -s -f /dev/rtc1
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
</code></pre></div>

<h3 id="seven-segment-display">Seven Segment Display</h3>
<p>Now we can install a Seven Segment Display [1] to show the time. I used an old Garfield clock with sentimental memories, and brought it back to life.</p>
<p>NOTE: If running python3, substitute python for python3 below.</p>
<ol>
<li><a href="https://www.adafruit.com/product/1270">https://www.adafruit.com/product/1270</a></li>
</ol>
<div class="highlight"><pre><span></span><code>$ sudo apt-get update
$ sudo apt-get install build-essential python-pip python-dev python-smbus git

$ git clone https://github.com/adafruit/Adafruit_Python_GPIO.git
$ cd Adafruit_Python_GPIO
$ sudo python setup.py install

$ git clone https://github.com/adafruit/Adafruit_Python_LED_Backpack.git

$ cd Adafruit_Python_LED_Backpack
$ sudo python setup.py install

$ git clone https://github.com/adafruit/Adafruit-GFX-Library.git

$ cd Adafruit_GFX
$ sudo python setup.py install
Adafruit Python LED Backpack

Python library for controlling LED backpack displays such as 8x8 matrices, bar graphs, and 7/14-segment displays on a Raspberry Pi or BeagleBone Black.

Designed specifically to work with the Adafruit LED backpack displays ----&gt; https://learn.adafruit.com/adafruit-led-backpack/overview

For all platforms (Raspberry Pi and Beaglebone Black) make sure your system is able to compile Python extensions. On Raspbian or Beaglebone Black&#39;s Debian/Ubuntu image you can ensure your system is ready by executing:

$ sudo apt-get update
$ sudo apt-get install build-essential python-dev

You will also need to make sure the python-smbus and python-imaging library is installed by executing:

$ sudo apt-get install python-smbus python-imaging

Install the library by downloading with the download link on the right, unzipping the archive, navigating inside the library&#39;s directory and executing:

$ sudo python setup.py install

See example of usage in the examples folder.
</code></pre></div>

<p>Clock testing</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python-pip
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>adafruit_gpio

$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>Adafruit_Python_LED_Backpack/examples

$<span class="w"> </span>python<span class="w"> </span>sevensegment_test.py
</code></pre></div>

<h3 id="clock-code">Clock Code</h3>
<p>File: clock.py</p>
<div class="highlight"><pre><span></span><code>import time

from Adafruit_LED_Backpack import SevenSegment


# Create display instance on default I2C address (0x70) and bus number.
display = SevenSegment.SevenSegment()

# Alternatively, create a display with a specific I2C address and/or bus.
# display = SevenSegment.SevenSegment(address=0x74, busnum=1)

# On BeagleBone, try busnum=2 if IOError occurs with busnum=1
# display = SevenSegment.SevenSegment(address=0x74, busnum=2)

# Initialize the display. Must be called once before using the display.
display.begin()

# Keep track of the colon being turned on or off.
colon = True

import datetime
now = datetime.datetime.now()
print (&quot;Current date and time : &quot;)
print (now.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;))
#
OLD_MIN = &quot;99&quot;
while True:
  MIN = now.strftime(&quot;%M&quot;)
  if ( MIN != OLD_MIN ):
         OLD_MIN = now.strftime(&quot;%M&quot;)
         # Clear the display buffer.
         display.clear()
         # Print the time to the display.
         display.print_number_str(now.strftime(&quot;%l%M&quot;))
         # PM flag, lower right dot
         display.set_decimal(3, 1)
         # ... set a segment of a digit ...
         #display.set_digit_raw(0, 1)
         # Set the colon on or off (True/False).
         display.set_colon(colon)
         # Write the display buffer to the hardware.  This must be called to
         # update the actual display LEDs.
         display.write_display()
         # Delay for a second.
     time.sleep(1.0)
     now = datetime.datetime.now()
     # Flip colon on or off.
     colon = not colon
     display.set_colon(colon)
     # Write the display buffer to the hardware.  This must be called to
     # update the actual display LEDs.
     display.write_display()
</code></pre></div>

<h2 id="music-player-for-the-car">Music Player for the Car</h2>
<p>This is a BBB under the seat with a wired mint box running Music Player Daemon [1].</p>
<h3 id="installed-three-buttons">Installed three buttons</h3>
<ul>
<li>
<p>Back - run <code>mpc prev</code></p>
</li>
<li>
<p>Play/Stop - run <code>mpc pause/play</code> </p>
</li>
<li>
<p>Forward - run <code>mpc next</code></p>
</li>
</ul>
<h3 id="wiring-pins">Wiring Pins</h3>
<p><img alt="BeagleBone-AI-2_1.png" src="/linux-in-house/images/BeagleBone-AI-2_1.png"></p>
<p><img alt="BeagleBone-AI-2_2.png" src="/linux-in-house/images/BeagleBone-AI-2_2.png"></p>
<h3 id="service">Service</h3>
<p>File: /etc/systemd/system/remote.service</p>
<div class="highlight"><pre><span></span><code>[Unit]
Description=Remote Control Music Player
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=always
RestartSec=1
User=root
ExecStop=/data/home/remote/remote_stop.sh
ExecStart=/data/home/remote/remote.sh

[Install]
WantedBy=multi-user.target
</code></pre></div>

<h3 id="forward">Forward</h3>
<p>File: forward.js</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**********************************************************************</span>
<span class="cm"> File: forward.js</span>
<span class="cm"> Usage: Wire 3.3v (P9_3) and GPIO (P8_8, P8_7, P8_9) to switches</span>
<span class="cm"> Service: remote.service</span>
<span class="cm"> Author: Don Cohoon</span>
<span class="cm"> History</span>
<span class="cm"> 16-Oct-2019   Created</span>
<span class="cm">**********************************************************************/</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bonescript&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">);</span>
<span class="c1">// GPIO inputs</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">FORWARD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_8&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PLAY</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_7&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Also STOP</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">REVERSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_9&#39;</span><span class="p">;</span>
<span class="c1">// Is button pressed or released?</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RELEASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PRESS</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="c1">//</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">FORWARD</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">PLAY</span><span class="p">,</span><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">REVERSE</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">check</span><span class="p">,</span><span class="mf">1000</span><span class="p">);</span>
<span class="c1">//</span>
<span class="c1">// ---------------------------</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">check</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">digitalRead</span><span class="p">(</span><span class="nx">FORWARD</span><span class="p">,</span><span class="w"> </span><span class="nx">checkForward</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ---------------------------</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">checkForward</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">){</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Forward pushed&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;/usr/bin/mpc next&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">stdout</span><span class="p">,</span><span class="w"> </span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stderr</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">//    console.log(&#39;Button NOT pushed&#39;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<h3 id="play">Play</h3>
<p>File: play.js</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**********************************************************************</span>
<span class="cm"> File: play.js</span>
<span class="cm"> Usage: Wire 3.3v (P9_3) and GPIO (P8_8, P8_7, P8_9) to switches</span>
<span class="cm"> Service: remote.service</span>
<span class="cm"> Author: Don Cohoon</span>
<span class="cm"> History</span>
<span class="cm"> 16-Oct-2019   Created</span>
<span class="cm">**********************************************************************/</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bonescript&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">);</span>
<span class="c1">// GPIO inputs</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">FORWARD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_8&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PLAY</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_7&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Also STOP</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">REVERSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_9&#39;</span><span class="p">;</span>
<span class="c1">// Is button pressed or released?</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RELEASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PRESS</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="c1">//</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">FORWARD</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">PLAY</span><span class="p">,</span><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">REVERSE</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">check</span><span class="p">,</span><span class="mf">1000</span><span class="p">);</span>
<span class="c1">//</span>
<span class="c1">// ---------------------------</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">check</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">digitalRead</span><span class="p">(</span><span class="nx">PLAY</span><span class="p">,</span><span class="w"> </span><span class="nx">checkPlay</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ---------------------------</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">checkPlay</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">){</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Play pushed&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;/usr/bin/mpc current&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">stdout</span><span class="p">,</span><span class="w"> </span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stderr</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Stop playing &#39;</span><span class="p">,</span><span class="nx">stdout</span><span class="p">);</span>
<span class="w">                </span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;/usr/bin/mpc stop&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">stdout</span><span class="p">,</span><span class="w"> </span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stderr</span><span class="p">);</span>
<span class="w">                        </span><span class="k">return</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Play resumed&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;/usr/bin/mpc play&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">stdout</span><span class="p">,</span><span class="w"> </span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stderr</span><span class="p">);</span>
<span class="w">                        </span><span class="k">return</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">});</span><span class="w"> </span><span class="c1">// current</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">//    console.log(&#39;Button NOT pushed&#39;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<h3 id="remote">Remote</h3>
<p>File: remote.sh</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_PATH</span><span class="o">=</span>/usr/local/lib/node_modules/
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_MODULES_CONTEXT</span><span class="o">=</span><span class="m">1</span>
<span class="nv">PIDFILE</span><span class="o">=</span>/var/run/remote.pid
<span class="c1"># node -pe &quot;require(&#39;bonescript&#39;).getPlatform().bonescript&quot;</span>
<span class="c1">#</span>
<span class="k">function</span><span class="w"> </span>log<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;`date` </span><span class="nv">$@</span><span class="s2"> &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/var/log/remote.log
<span class="o">}</span>
<span class="c1">#</span>
<span class="nv">procs</span><span class="o">=(</span>
<span class="w">     </span><span class="s1">&#39;/data/home/remote/forward.js&#39;</span>
<span class="w">     </span><span class="s1">&#39;/data/home/remote/play.js &#39;</span>
<span class="w">     </span><span class="s1">&#39;/data/home/remote/reverse.js&#39;</span>
<span class="w">    </span><span class="o">)</span>
<span class="nv">n_procs</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;x</span><span class="si">${</span><span class="nv">procs</span><span class="p">[n_procs]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="w"> </span><span class="o">]</span>
<span class="k">do</span>
<span class="w">       </span><span class="nv">n_procs</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="nv">$n_procs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="k">))</span>
<span class="k">done</span>
<span class="nv">inx</span><span class="o">=</span><span class="m">1</span>
<span class="c1">#</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$$</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$PIDFILE</span>
<span class="nb">cd</span><span class="w"> </span>/data/home/remote
log<span class="w"> </span><span class="s2">&quot;Starting </span><span class="nv">$$</span><span class="s2">&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="nb">true</span>
<span class="k">do</span>
<span class="w">    </span><span class="c1"># run processes and store pids in array</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">procs</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting /usr/bin/node </span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">      </span>/usr/bin/node<span class="w"> </span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">      </span>pids<span class="o">[</span><span class="si">${</span><span class="nv">inx</span><span class="si">}</span><span class="o">]=</span><span class="nv">$!</span>
<span class="w">      </span><span class="nb">let</span><span class="w"> </span><span class="s2">&quot;inx = </span><span class="nv">$inx</span><span class="s2"> + 1&quot;</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="c1"># wait for all pids</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">pids</span><span class="p">[*]</span><span class="si">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>pid<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">pids</span><span class="p">[*]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">          </span><span class="nb">wait</span><span class="w"> </span><span class="nv">$pid</span>
<span class="w">        </span><span class="k">done</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">30</span>
<span class="w">    </span>log<span class="w"> </span><span class="s2">&quot;Restarting after error&quot;</span>
<span class="k">done</span>
</code></pre></div>

<h3 id="remote-stop">Remote Stop</h3>
<p>File: remote_stop.sh</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">TPID</span><span class="o">=</span><span class="k">$(</span><span class="w"> </span>/bin/cat<span class="w"> </span>/var/run/remote.pid<span class="w"> </span><span class="k">)</span>
/bin/kill<span class="w"> </span>-9<span class="w"> </span><span class="si">${</span><span class="nv">TPID</span><span class="si">}</span>
/usr/bin/killall<span class="w"> </span>-e<span class="w"> </span>/usr/bin/node
</code></pre></div>

<h3 id="reverse">Reverse</h3>
<p>File: reverse.js</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**********************************************************************</span>
<span class="cm"> File: reverse.js</span>
<span class="cm"> Usage: Wire 3.3v (P9_3) and GPIO (P8_8, P8_7, P8_9) to switches</span>
<span class="cm"> Service: remote.service</span>
<span class="cm"> Author: Don Cohoon</span>
<span class="cm"> History</span>
<span class="cm"> 16-Oct-2019   Created</span>
<span class="cm">**********************************************************************/</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bonescript&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">);</span>
<span class="c1">// GPIO inputs</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">FORWARD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_8&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PLAY</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_7&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Also STOP</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">REVERSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P8_9&#39;</span><span class="p">;</span>
<span class="c1">// Is button pressed or released?</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">RELEASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">PRESS</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="c1">//</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">FORWARD</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">PLAY</span><span class="p">,</span><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">REVERSE</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">);</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">check</span><span class="p">,</span><span class="mf">1000</span><span class="p">);</span>
<span class="c1">//</span>
<span class="c1">// ---------------------------</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">check</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">digitalRead</span><span class="p">(</span><span class="nx">REVERSE</span><span class="p">,</span><span class="w"> </span><span class="nx">checkReverse</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ---------------------------</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">checkReverse</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">){</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Reverse pushed&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;/usr/bin/mpc prev&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">stdout</span><span class="p">,</span><span class="w"> </span><span class="nx">stderr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stderr</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">//    console.log(&#39;Button NOT pushed&#39;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<ol>
<li><a href="https://www.musicpd.org/">https://www.musicpd.org/</a></li>
</ol>
<h1 id="power-onoff-another-pc">Power on/off another PC</h1>
<p>This project uses a web application written in flask to power on or off two different PCs remotely, and also a PowerTail Switch.</p>
<ul>
<li>Server one:</li>
<li>Wire pins P8_11 in parallel to power button</li>
<li>
<p>Wire pins P8_12 in parallel to reset button</p>
</li>
<li>
<p>Server two:</p>
</li>
<li>Wire pins P8_13 in parallel to power button</li>
<li>
<p>Wire pins P8_14 in parallel to reset button</p>
</li>
<li>
<p>PowerTail Light [1]</p>
</li>
<li>
<p>Wire pins P9_21 to the PowerTail input control screws</p>
</li>
<li>
<p><a href="https://www.adafruit.com/product/2935">https://www.adafruit.com/product/2935</a></p>
</li>
</ul>
<p>File: boot.py</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>                                                     
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">werkzeug.debug</span> <span class="kn">import</span> <span class="n">DebuggedApplication</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;boot.log&#39;</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Limit ddos</span>
<span class="kn">from</span> <span class="nn">werkzeug.wrappers</span> <span class="kn">import</span> <span class="n">BaseRequest</span> <span class="p">,</span> <span class="n">BaseResponse</span>
<span class="k">class</span> <span class="nc">Response</span> <span class="p">(</span> <span class="n">BaseResponse</span><span class="p">):</span>
    <span class="c1"># limit 1m for input request and form response</span>
    <span class="n">max_content_length</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="n">max_form_memory_size</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1</span>

<span class="kn">import</span> <span class="nn">Adafruit_BBIO.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;P9_21&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P9_21&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span> <span class="c1"># TimeLight off</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;P8_11&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_11&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;P8_12&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_12&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;P8_13&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_13&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;P8_14&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_14&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>


<span class="n">ASSETS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>                                            

<span class="c1">#@app.before_request # to get your header token and check for its validity</span>

<span class="c1">#---------------------------------</span>
<span class="c1"># route for handling the login page logic</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;SecretUser&#39;</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;SecretPassword&#39;</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid Credentials. Please try again.&#39;</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;logged_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;logged_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;secret_page&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>

<span class="c1">#---------------------------------</span>
<span class="c1"># default page</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>                                                                 
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/index&quot;</span><span class="p">)</span>                                                          
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>                                                    

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>

<span class="c1">#---------------------------------</span>
<span class="c1"># control server boot actions</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/secret-page&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">secret_page</span><span class="p">():</span>
    <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="s1">&#39;logged_in&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
      <span class="n">start_time</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;session_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_time</span>
      <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">end_time</span><span class="p">:</span> 
        <span class="n">session</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>

    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Agent: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Host: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Host&#39;</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Auth: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">))</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s2">&quot;uptime&quot;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="c1">#print &quot;program output:&quot;, out</span>
    <span class="n">option</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
      <span class="n">option</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="s1">&#39;empty&#39;</span><span class="p">)</span>
      <span class="c1">#option = request.form[&#39;options&#39;]</span>
      <span class="c1">#print &quot;option:&quot;, option</span>
      <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>                                                           
    <span class="c1">#app.logger.debug(&#39;A value for debugging&#39;)</span>
    <span class="c1">#app.logger.warning(&#39;A warning occurred (%d apples)&#39;, 42)</span>
    <span class="c1">#app.logger.error(&#39;An error occurred&#39;)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was turned on&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_11&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                                                          
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_11&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was turned on (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Server turned on.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>                                                          
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was turned off&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_11&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_11&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was turned off (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Server turned off.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;reset&#39;</span><span class="p">:</span>                                                          
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was reset&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_12&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_12&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was reset (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Server reset.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;on2&#39;</span><span class="p">:</span>                                                           
    <span class="c1">#app.logger.debug(&#39;A value for debugging&#39;)</span>
    <span class="c1">#app.logger.warning(&#39;A warning occurred (%d apples)&#39;, 42)</span>
    <span class="c1">#app.logger.error(&#39;An error occurred&#39;)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;NAS was turned on&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_14&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                                                          
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_14&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;NAS was turned on (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;NAS turned on.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;off2&#39;</span><span class="p">:</span>                                                          
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;NAS was turned off&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_14&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_14&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;NAS was turned off (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;NAS turned off.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;reset2&#39;</span><span class="p">:</span>                                                          
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Server was reset&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_13&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P8_13&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;NAS was reset (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;NAS reset.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;on3&#39;</span><span class="p">:</span>                                                           
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;TimeLight was turned on&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P9_21&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;TimeLight was turned on (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;TimeLight turned on.&#39;</span>
      <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;off3&#39;</span><span class="p">:</span>                                                          
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;TimeLight was turned off&#39;</span><span class="p">)</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;P9_21&quot;</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;TimeLight was turned off (end)&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;TimeLight turned off.&#39;</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Pick one.&#39;</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No option picked&#39;</span><span class="p">)</span>
    <span class="n">template_data</span> <span class="o">=</span> <span class="p">{</span>                                                           
        <span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="n">option</span><span class="p">,</span>                                                        
        <span class="s1">&#39;msg&#39;</span>   <span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
        <span class="s1">&#39;out&#39;</span>   <span class="p">:</span> <span class="n">out</span><span class="p">,</span>
    <span class="p">}</span>                                                                           
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;secret_page.html&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">template_data</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span> <span class="nf">apply_caching</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Waiter&quot;</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>                                                      
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
</code></pre></div>

<p>File: secret_page.html</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>                                                                 
   <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>                                                                       
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span> 
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span>
      <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{url_for(&#39;static&#39;,filename=&#39;bootstrap.css&#39;)}}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span> <span class="s">&quot;text/css&quot;</span>
      <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{url_for(&#39;static&#39;,filename=&#39;bootstrap-theme.css&#39;)}}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">   </span><span class="kd">function</span><span class="w"> </span><span class="nx">clickAndDisable</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="c1">// disable subsequent clicks</span>
<span class="w">     </span><span class="nx">link</span><span class="p">.</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;sub&quot;</span><span class="p">).</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;btn btn-default disabled&quot;</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span><span class="w">   </span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>                                                                     
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>                                                                      
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-lg-1 col-centered&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span> {{ out }} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;boot&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">onsubmit</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                 <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;on&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;on&quot;</span><span class="p">&gt;</span>
                 S-On
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;off&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;off&quot;</span><span class="p">&gt;</span>
                 S-Off
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;reset&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;reset&quot;</span><span class="p">&gt;</span>
                 S-Reset
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                 <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;on2&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;on2&quot;</span><span class="p">&gt;</span>
                 N-On
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;off2&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;off2&quot;</span><span class="p">&gt;</span>
                 N-Off
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;reset2&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;reset2&quot;</span><span class="p">&gt;</span>
                 N-Reset
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                 <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;on3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;on3&quot;</span><span class="p">&gt;</span>
                 L-On
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
             <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check&quot;</span><span class="p">&gt;</span>
               <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-label&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-check-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;options&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;off3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;off3&quot;</span><span class="p">&gt;</span>
                 L-Off
               <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
           <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
           <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Submit</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;sub&quot;</span>
                  <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;clickAndDisable(this);&quot;</span>
                  <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span><span class="p">&gt;</span>
           <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
         <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span> 
           {{ msg }}
       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>                                                                     
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>File: login.html</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>login page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span>
      <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{url_for(&#39;static&#39;,filename=&#39;bootstrap.css&#39;)}}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span> <span class="s">&quot;text/css&quot;</span>
      <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{url_for(&#39;static&#39;,filename=&#39;bootstrap-theme.css&#39;)}}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-lg-1 col-centered&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Please login<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group row&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Username&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{</span>
<span class="s">          request.form.username }}&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group row&quot;</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{</span>
<span class="s">          request.form.password }}&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group row&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Login&quot;</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
      {% if error %}
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Error:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ error }}
      {% endif %}
     <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>File: main.html</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>                                                                 
   <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>                                                                       
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>                                                                                   
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>                                                                     
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>                                                                      
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/on&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;on&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;large_button&quot;</span><span class="p">&gt;</span>ON<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/off&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;off&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;large_button&quot;</span><span class="p">&gt;</span>OFF<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>                                                                     
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<blockquote>
<p>Put the bootstrap css package in directory ./static.</p>
</blockquote>
<p>Reference: <a href="https://getbootstrap.com/">https://getbootstrap.com/</a></p>
<h1 id="reference">Reference</h1>
<div class="highlight"><pre><span></span><code>@book{9781119533160,
   Author = {Derek Molloy},
   Title = {Exploring BeagleBone: Tools and Techniques for Building with Embedded Linux},
   Publisher = {Wiley},
   Edition = {Second},
   Year = {2019},
   ISBN = {9781119533160},
   URL = {http://www.exploringbeaglebone.com/}
}
</code></pre></div>

<p>Code for book: <a href="https://github.com/derekmolloy/exploringBB">https://github.com/derekmolloy/exploringBB</a></p>
<h1 id="continue">Continue</h1>
<p>Now that you have experimented with BeagleBone SBC, next our travels take us far away to Media Land. The sights and sounds of Video and Audio controlled and maintained by your computer.</p>
<p>Proceed in the order presented, some things are depending on prior setups.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://lwn.net/">Linux Weekly News</a></li>
                            <li><a href="https://fullcirclemagazine.org/">Full Circle Magazine</a></li>
                            <li><a href="https://www.linuxjournal.com/">Linux Journal</a></li>
                            <li><a href="https://www.linux-magazine.com/">Linux Magazine</a></li>
                            <li><a href="https://www.thefarside.com/">The Far Side</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://dfcsoftware.github.io/linux-in-house/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://fosstodon.org/@Cohoon">Feedback</a></li>
                            <li><a href="https://fosstodon.org/@Cohoon.rss">Mastodon RSS feed</a></li>
                            <li><a href="https://linux-in-the-house.pages.dev/">Book</a></li>
                            <li><a href="/linux-in-house/author/don-cohoon.html">Created by: Don Cohoon</a></li>
                            <li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License </a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>
                Made for Humans, by a Human.
                </p>
                <p>
                Site by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, via <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </p><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                <p> Version:  3.288 </p>
        </footer><!-- /#contentinfo -->

</body>
</html>